<!doctype html>
<!--
* Tabler - Premium and Open Source dashboard template with responsive and high quality UI.
* @version 1.0.0-beta5
* @link https://tabler.io
* Copyright 2018-2022 The Tabler Authors
* Copyright 2018-2022 codecalm.net Paweł Kuna
* Licensed under MIT (https://github.com/tabler/tabler/blob/master/LICENSE)
-->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
  <title>Yes Aladin! - Register Product</title>

  <!-- CSS files -->
  <link th:href="@{/css/tabler.min.css}" rel="stylesheet"/>
  <link th:href="@{/css/tabler-flags.min.css}" rel="stylesheet"/>
  <link th:href="@{/css/tabler-payments.min.css}" rel="stylesheet"/>
  <link th:href="@{/css/tabler-vendors.min.css}" rel="stylesheet"/>
  <link th:href="@{/css/demo.min.css}" rel="stylesheet"/>

  <!-- tui-editor -->
  <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
  <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
</head>
<body>
  <!-- Libs JS -->
  <script type="text/javascript" th:src="@{/libs/apexcharts/dist/apexcharts.min.js}"></script>
  <!-- Tabler Core -->
  <script type="text/javascript" th:src="@{/js/tabler.min.js}"></script>
  <script type="text/javascript" th:src="@{/js/demo.min.js}"></script>

  <div class="wrapper">
    <!-- TODO 1 : HEADER -->
    <div th:replace="~{fragments/header :: fragment-header}"></div>

    <!-- TODO 2 : NAV-BAR -->
    <div th:replace="~{fragments/navbar :: fragment-nav-bar}"></div>

    <!-- TODO 3: BODY -->
    <div class="page-body">
      <div class="container">
        <form class="card product-form" action="/web/products/register" method="post">
          <div class="card-header">
            <div class="card-title">
              <h3>Yes Aladin!</h3>
              <h2>상품 등록</h2>
            </div>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <!-- 동일한 ISBN이 있는지 확인 필요-->
              <label class="form-label">상품 ISBN</label>
              <input type="text" class="form-control" name="isbn" placeholder="ISBN..." maxlength="13">
              <div class="invalid-feedback">ISBN을 입력해주세요.</div>
            </div>

            <div class="mb-3">
              <div class="form-label">썸네일 파일</div>
              <input type="file" name="thumbnailFile" class="form-control"
                     accept="image/bmp, image/tiff, image/gif, image/jpeg, image/png">
            </div>

            <div class="mb-3">
              <label class="form-label">제목</label>
              <input type="text" class="form-control" name="title" placeholder="Title..." maxlength="255">
              <div class="invalid-feedback">제목을 입력해주세요.</div>
            </div>
            <div class="mb-3">
              <label class="form-label">목차</label>
              <textarea class="form-control" name="contents" rows="6" placeholder=""></textarea>
            </div>

            <div class="mb-3">
              <label class="form-label">설명</label>
              <div id="editor"></div>
              <input type="hidden" id="description" name="description">
            </div>

            <div class="mb-3">
              <div class="form-label">E-book 파일</div>
              <input type="file" name="ebookFile" class="form-control"
                      accept="application/epub+zip, application/pdf, application/vnd.comicbook+zip">
            </div>

            <!--             TODO: 저자, 출판사 선홍님 검색으로 교체 예정 -->
            <!--                        <div class="mb-3"> -->
            <!--              <label class="form-label">저자</label>-->
            <!--              <div class="input-icon">-->
            <!--                <input type="text" value="" class="form-control form-control-rounded" placeholder="Search Author...">-->
            <!--                <span class="input-icon-addon">-->
            <!--                  &lt;!&ndash; Download SVG icon from http://tabler-icons.io/i/search &ndash;&gt;-->
            <!--                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="10" cy="10" r="7"></circle><line x1="21" y1="21" x2="15" y2="15"></line></svg>-->
            <!--                </span>-->
            <!--              </div>-->
            <!--            </div>-->
            <!--            <div class="mb-3">-->
            <!--              <label class="form-label">출판사</label>-->
            <!--              <div class="input-icon">-->
            <!--                <input type="text" value="" class="form-control form-control-rounded" placeholder="Search Publisher...">-->
            <!--                <span class="input-icon-addon">-->
            <!--                  &lt;!&ndash; Download SVG icon from http://tabler-icons.io/i/search &ndash;&gt;-->
            <!--                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="10" cy="10" r="7"></circle><line x1="21" y1="21" x2="15" y2="15"></line></svg>-->
            <!--                </span>-->
            <!--              </div>-->
            <!--            </div>-->
            <!-- 테스트용 저자, 출판사 -->
            <div class="mb-3">
              <label class="form-label">저자</label><!-- 다중 선택 가능하도록! -->
              <select type="text"  class="form-select tomselected ts-hidden-accessible" multiple="multiple" name="authors" id="select-authors" value="" tabindex="-1">
                <option value="" disabled>-- Select Authors --</option>
                <option th:each="author : ${authors}" th:value="${author.getId()}" th:utext="${author.getName()}"/>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">출판사</label>
              <select type="text" class="form-select tomselected ts-hidden-accessible" name="publisher" id="select-publishers" value="" tabindex="-1">
                <option value="" disabled>-- Select Publisher --</option>
                <option th:each="publisher : ${publishers}" th:value="${publisher.getId()}" th:utext="${publisher.getName()}"/>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">출판일</label>
              <div class="input-icon">
                <span class="input-icon-addon"><!-- Download SVG icon from http://tabler-icons.io/i/calendar -->
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><rect x="4" y="5" width="16" height="16" rx="2"></rect><line x1="16" y1="3" x2="16" y2="7"></line><line x1="8" y1="3" x2="8" y2="7"></line><line x1="4" y1="11" x2="20" y2="11"></line><line x1="11" y1="15" x2="12" y2="15"></line><line x1="12" y1="15" x2="12" y2="18"></line></svg>
                </span>
                <input class="form-control" name="published-date" id="datepicker-icon-prepend" value="">
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">상품 유형</label>
              <select type="text" class="form-select tomselected ts-hidden-accessible" id="select-type" value="" tabindex="-1">
                <option value="">-- Select Product Type --</option>
                <option th:each="type : ${types}" th:value="${type.getId()}" th:utext="${type.getType()}"/>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">상품 태그</label>
              <select type="text" class="form-select tomselected ts-hidden-accessible" id="select-tags" multiple="multiple" value="" tabindex="-1">
                <option value="" disabled>-- Select Tags --</option>
                <option th:each="tag : ${tags}" th:value="${tag.getId()}" th:utext="${tag.getName()}"/>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">정가</label>
              <input type="text" class="form-control" name="actual-price" placeholder="Actual Price..." min="0">
              <div class="invalid-feedback">정가를 입력해주세요.</div><br/>
              <label class="form-check form-switch">
                <input class="form-check-input" name="discount" type="checkbox" onclick="changeDisplay('discount-info')">
                <span class="form-check-label">개별 할인 적용</span>
              </label>
              <div id="discount-info" style="display: none;">
                <div class="mb-3">
                  <label class="form-label">할인율</label>
                  <input type="text" class="form-control" name="discount-rate" placeholder="Discount Rate..." min="0" max="100">
                  <div class="invalid-feedback">할인율을 입력해주세요.</div>
                </div>
              </div>
              <label class="form-check form-switch">
                <input class="form-check-input" name="point" type="checkbox" onclick="changeDisplay('point-info')">
                <span class="form-check-label">포인트 적립 적용</span>
              </label>
              <div id="point-info" style="display: none;">
                <div class="mb-3">
                  <label class="form-label">포인트 적립율</label>
                  <input type="text" class="form-control" name="given-point-rate" placeholder="Given Point Rate..." min="0" max="100">
                  <div class="invalid-feedback">포인트 적립율을 입력해주세요.</div>
                </div>
                <div class="mb-3">
                  <div class="form-label">포인트 적립 방식</div>
                  <div>
                    <label class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="saving-method" checked="checked">
                      <span class="form-check-label">실구매가</span>
                    </label>
                    <label class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="saving-method">
                      <span class="form-check-label">판매가</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-check form-switch">
                <input class="form-check-input" name="subscribe" type="checkbox" onclick="changeDisplay('subscribe-info')">
                <span class="form-check-label">구독 적용</span>
              </label>
              <div id="subscribe-info" style="display: none;">
                <div class="mb-3">
                  <label class="form-label">구독 상품 ISSN</label>
                  <input type="text" class="form-control" name="issn" placeholder="ISSN..." maxlength="8">
                  <div class="invalid-feedback">ISSN을 입력해주세요.</div>
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">수량</label>
              <input type="text" class="form-control" name="quantity" placeholder="Quantity..." min="0">
              <div class="invalid-feedback">수량을 입력해주세요.</div>
            </div>

            <div class="mb-3">
              <label class="form-label">노출 우선 순위</label>
              <input type="text" class="form-control" name="show-ranking" placeholder="Show Ranking...">
              <div class="invalid-feedback">노출 우선 순위를 입력해주세요.</div>
            </div>

            <div class="mb-3">
              <div class="form-label">상품 판매 여부</div>
              <label class="form-check form-switch">
                <input class="form-check-input" type="checkbox" checked="checked">
                <span class="form-check-label">상품을 판매합니다.</span>
              </label>
            </div>
          </div>
          <div class="card-footer text-end">
            <div class="d-flex">
              <a href="#" class="btn btn-link">취소</a>
              <button type="submit" class="btn btn-primary ms-auto">등록</button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- TODO 4 : footer -->
    <div th:replace="~{fragments/footer :: fragment-footer}"></div>
  </div>
  <!-- DOMContentLoaded관련 Script import -->
  <div th:replace="~{fragments/script :: fragment-script}"></div>
  <!-- toast ui editor-->
  <script>
    const Editor = toastui.Editor;

    const editor = new Editor({
      el: document.querySelector('#editor'),
      previewStyle: 'vertical',
      height: '500px'
    });

    editor.addHook('addImageBlobHook', (blob, callback) => {
      const formData = new FormData();
      formData.append("data", blob);

      if (blob.size > 12582912) {
        return window.alert("File size : " + blob.size + " => 이미지 파일 최대 용량 초과");
      }

      fetch(location.origin.toString() + "/web/files/file-upload",
          {
            method: 'POST',
            body: formData})
      .then(res => res.json())
      .then(data => callback(data.filename, document.getElementById('toastuiAltTextInput').getAttribute('value')))
      .catch(err => {
        window.alert(err);
      });
    });

    function changeDisplay(target) {
      let pre = document.getElementById(target);
      if (pre.style.display == 'none')
        pre.style.display = 'block';
      else
        pre.style.display = 'none';
    }

    window.addEventListener('load', () => {
      const productForm = document.getElementsByClassName('product-form');

      Array.prototype.filter.call(productForm, (product) => {
        product.addEventListener('submit', function (event) {
          console.log('html: ' + editor.getHTML());
          document.querySelector('#description').setAttribute('value', editor.getHTML());
        }, false);
      });
    }, false);

  </script>
</body>
</html>
