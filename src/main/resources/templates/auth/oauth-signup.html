<!doctype html>
<!--
* Tabler - Premium and Open Source dashboard template with responsive and high quality UI.
* @version 1.0.0-beta5
* @link https://tabler.io
* Copyright 2018-2022 The Tabler Authors
* Copyright 2018-2022 codecalm.net Paweł Kuna
* Licensed under MIT (https://github.com/tabler/tabler/blob/master/LICENSE)
-->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
  <title>Yes Aladin! - OAuth2 SignUp</title>
  <!-- CSS files -->
  <link th:href="@{/css/tabler.min.css}" rel="stylesheet"/>
  <link th:href="@{/css/tabler-flags.min.css}" rel="stylesheet"/>
  <link th:href="@{/css/tabler-payments.min.css}" rel="stylesheet"/>
  <link th:href="@{/css/tabler-vendors.min.css}" rel="stylesheet"/>
  <link th:href="@{/css/demo.min.css}" rel="stylesheet"/>
</head>
<body>
<!-- Libs JS -->
<script type="text/javascript" th:src="@{/libs/apexcharts/dist/apexcharts.min.js}"></script>
<!-- Tabler Core -->
<script type="text/javascript" th:src="@{/js/tabler.min.js}"></script>
<script type="text/javascript" th:src="@{/js/demo.min.js}"></script>
<script type="text/javascript" th:src="@{/js/member/oauthSignup.js}"></script>

<div class="wrapper">
  <!-- TODO 1 : HEADER -->
  <div th:replace="~{common/fragments/header :: fragment-header}"></div>

  <!-- TODO 2 : NAV-BAR -->
  <div th:replace="~{common/fragments/navbar :: fragment-nav-bar}"></div>

  <!-- TODO 3: BODY -->

  <div class="page-wrapper">
    <div class="page page-center">
      <div class="container container-tight py-4">
        <div class="text-center mb-4">
          <a href="." class="navbar-brand navbar-brand-autodark"><img src="./static/logo.svg"
                                                                      height="36" alt=""></a>
        </div>
        <form class="signup-form" id="signup-form" action="/members/oauth2/signup" method="post"
              autocomplete="off" novalidate="">
          <div class="card-body">
            <h2 class="card-title text-center mb-4">OAuth2 Login 시 YesAladin 자사 회원 등록을 위해 추가 정보를 입력해주세요.</h2>
            <div class="mb-3">
              <label class="form-label">이름</label>
              <input type="text" class="form-control" id="name" th:name="name" placeholder="이름"
                     pattern="^.*(?=.*[가-힣a-z])(?=^.{2,200}).*$"
                     required>
              <div class="invalid-feedback">
                이름을 입력해주세요.
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">닉네임</label>
              <input type="text" class="form-control" id="nickname" th:name="nickname"
                     pattern="^[가-힣ㄱ-ㅎa-zA-Z0-9._-]{2,15}$"
                     placeholder="숫자, 영어, 한국어와 언더스코어, 공백을 허용하며 최소 2자 이상의 15자 이하의 닉네임만 가능합니다." required>
              <div class="invalid-feedback">
                숫자, 영어, 한국어와 언더스코어, 공백을 허용하며 최소 2자 이상의 15자 이하의 닉네임만 가능합니다.
              </div>
              <div class="button-box">
                <button class="nicknameCheckBtn" id="nicknameCheckBtn" type="button" onclick="nicknameCheck()">중복 확인</button>
              </div>
            </div>
            <input th:value="${oauthMember.loginId}" id="loginId" name="loginId" hidden="hidden">
            <input th:value="${oauthMember.password}" id="password" name="password" hidden="hidden">
            <div class="mb-3">
              <label class="form-label">이메일 주소</label>
              <input type="email" class="form-control" id="email" th:name="email" placeholder="이메일"
                     pattern="^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$"
                     required>
              <div class="invalid-feedback">
                이메일 주소를 입력해주세요.
              </div>
              <div class="button-box">
                <button class="emailCheckBtn" id="emailCheckBtn" type="button" onclick="emailCheck()">중복 확인</button>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">휴대폰 번호</label>
              <input type="text" class="form-control" id="phone" th:name="phone"
                     pattern="([0-9]{11})"
                     placeholder="휴대폰 번호 ex) 01012345678" required>
              <div class="invalid-feedback">
                휴대폰 번호를 - 없이 11자 입력해주세요.
              </div>
              <div class="button-box">
                <button class="phoneCheckBtn" id="phoneCheckBtn" type="button" onclick="phoneCheck()">중복 확인</button>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">생년월일</label>
              <input type="text" class="form-control" id="birth" placeholder="예시: 20230101"
                     pattern="([0-9]{8})"
                     th:name="birth" required>
              <div class="invalid-feedback">
                생년월일을 정확하게 입력해주세요.
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">성별</label>
              <div class="row g-2">
                <div class="col-5">
                  <select name="gender" class="form-select" id="gender" required>
                    <option value="">성별</option>
                    <option value="MALE">남성</option>
                    <option value="FEMALE">여성</option>
                  </select>
                  <div class="invalid-feedback">
                    성별을 선택해주세요.
                  </div>
                </div>
              </div>
            </div>
            <div class="form-footer">
              <button type="submit" class="btn btn-primary w-100" id="createAccountBtn" disabled>Create new account</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- TODO 4 : footer -->
  <div th:replace="~{common/fragments/footer :: fragment-footer}"></div>
</div>
<script>
  window.addEventListener('load', () => {
    const signupForm = document.getElementsByClassName('signup-form');

    let emptyRegex = /\s/g;
    let nameRegex = /^.*(?=.*[가-힣a-z])(?=^.{2,200}).*$/;
    let nicknameRegex = /^[가-힣ㄱ-ㅎa-zA-Z0-9._-]{2,15}$/;
    let birthdayRegex = /^.*(?=.*\d)(?=^.{6}).*$/;
    let phoneRegex = /^\d{11}$/;

    Array.prototype.filter.call(signupForm, (signupForm) => {
      signupForm.addEventListener('submit', function (event) {
        if (signupForm.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }

        let nameVal = document.getElementById('name').value;
        if (!nameRegex.test(nameVal) || emptyRegex.test(nameVal)) {
          alert('이름을 올바르게 입력해주세요.')
          return false;
        }

        let nicknameVal = document.getElementById('nickname').value;
        if (!nicknameRegex.test(nicknameVal) || emptyRegex.test(nicknameVal)) {
          alert('숫자, 영어, 한국어와 언더스코어, 공백을 허용하며 최소 2자 이상의 15자 이하의 닉네임만 가능합니다.');
          return false;
        }

        let birthdayVal = document.getElementById('birth').value;
        if (!birthdayRegex.test(birthdayVal) || emptyRegex.test(birthdayVal)) {
          alert('생년월일 8자를 - 없이 입력해주세요. ex) 20230101');
          return false;
        }

        let phoneVal = document.getElementById('phone').value;
        if (!phoneRegex.test(phoneVal) || emptyRegex.test(phoneVal)) {
          alert('휴대폰 번호를 - 없이 13자 입력해주세요.');
          return false;
        }

        signupForm.classList.add('was-validated');
      }, false);
    });
  }, false);
</script>
</body>
</html>