<!doctype html>
<!--
* Tabler - Premium and Open Source dashboard template with responsive and high quality UI.
* @version 1.0.0-beta5
* @link https://tabler.io
* Copyright 2018-2022 The Tabler Authors
* Copyright 2018-2022 codecalm.net Paweł Kuna
* Licensed under MIT (https://github.com/tabler/tabler/blob/master/LICENSE)
-->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
  <title>Yes Aladin!</title>
  <!-- CSS files -->
  <link th:href="@{/css/tabler.min.css}" rel="stylesheet"/>
  <link th:href="@{/css/tabler-flags.min.css}" rel="stylesheet"/>
  <link th:href="@{/css/tabler-payments.min.css}" rel="stylesheet"/>
  <link th:href="@{/css/tabler-vendors.min.css}" rel="stylesheet"/>
  <link th:href="@{/css/demo.min.css}" rel="stylesheet"/>
</head>
<body>
<!-- Libs JS -->
<script type="text/javascript" th:src="@{/libs/apexcharts/dist/apexcharts.min.js}"></script>
<!-- Tabler Core -->
<script type="text/javascript" th:src="@{/js/tabler.min.js}"></script>
<script type="text/javascript" th:src="@{/js/demo.min.js}"></script>


<div class="wrapper">
  <!-- TODO 1 : Head -->
  <div th:replace="~{common/fragments/header :: fragment-header}"></div>
  <!-- TODO 2 : NAV-BAR -->
  <div th:replace="~{common/fragments/navbar :: fragment-nav-bar}"></div>

  <div class="page-wrapper">
    <div class="page-header d-print-none">
      <div class="container-xl">
        <div class="row g-2 align-items-center">
          <div class="col">
            <h2 class="page-title">
              마이 페이지
            </h2>
          </div>
        </div>
      </div>
    </div>
    <div class="page-body">
      <div class="container-xl">
        <div class="card">
          <div class="row g-0">
            <div class="col-xl-3 col-lg-3 bg-secondary-lt">
              <div class="card-body">
                <div th:replace="~{mypage/fragments/sidebar :: fragment-side-bar}"></div>
              </div>
            </div>
            <div class="col-xl-9 col-lg-9" id="mypage"
                 th:data-url="${@environment.getProperty('yesaladin.front.url')}"
                 th:data-shop-url="${@environment.getProperty('yesaladin.gateway.shop')}">
              <div class="card-body">
                <!-- TODO 3: BODY -->
                <h1 class="text-end" th:text="${#authentication.name +' 님 안녕하세요'}"></h1>
                <div class="row row-cards mb-3">
                  <div class="col-xl-5 col-md-5">
                    <div class="card">
                      <div class="card-header d-block">
                        <h3 class="card-title d-inline">
                          회원 등급
                          <span id="member-grade" class="card-subtitle ms-1 float-end text-muted"
                                th:text="${'white'}"></span>
                        </h3>
                      </div>
                      <div class="card-body m-auto">
                        <a href="/mypage/grade-history/test"
                           class="btn btn-outline-secondary btn-sm d-inline">회원 등급변경 내역</a>
                      </div>
                    </div>
                  </div>
                  <div class="col-xl-7 col-md-7">
                    <div class="card">
                      <div class="card-header d-block">
                        <h3 class="card-title d-inline">
                          포인트
                          <span id="member-point" class="card-subtitle ms-1 float-end text-muted"
                                th:text="${'원'}"></span>
                        </h3>
                      </div>
                      <div class="card-body m-auto">
                        <a href="/mypage/point-history/test"
                           class="btn btn-outline-secondary btn-sm d-inline m-1">포인트 이용 내역</a>
                        <a href="#" class="btn btn-primary btn-sm d-inline m-1">포인트 충전</a>
                        <a href="#" class="btn btn-info btn-sm d-inline m-1">포인트 선물</a>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row row-cards mb-3">
                  <div class="col-xl-5 col-md-5">
                    <div class="card">
                      <div class="card-header d-block">
                        <h3 class="card-title d-inline">
                          쿠폰
                          <span class="card-subtitle ms-1 float-end text-muted"
                                th:text="${'개'}"></span>
                        </h3>
                      </div>
                      <div class="card-body m-auto">
                        <a class="btn btn-outline-secondary btn-sm d-inline"
                           th:href="@{/mypage/coupon}">쿠폰 목록</a>
                      </div>
                    </div>
                  </div>
                  <div class="col-xl-7 col-md-7">
                    <div class="card">
                      <div class="card-header d-block">
                        <h3 class="card-title d-inline">재입고 알림 신청 상품</h3>
                      </div>
                      <div class="card-body m-auto">
                        <div class="float-start w-auto d-inline"><span class="mb-3">알림 신청</span>
                          <span
                              th:text="${'___건'}"></span></div>
                        /
                        <div class="float-end w-auto d-inline"><span class="mb-3">알림 완료</span> <span
                            th:text="${'___건'}"></span></div>
                      </div>
                    </div>
                  </div>
                </div>
                <hr>
                <h3 class="sub-title">주문 상태</h3>
                <div class="row row-cards mb-2">
                  <div class="col-3">
                    <div class="card card-stacked">
                      <div class="card-body text-center">
                        <h3 class="card-title">입금/결제 대기</h3>
                        <a class="text-muted w-auto btn"
                           href="javascript:openWindowPop('/mypage/order-popup?code=1', 'popup');">___건</a>
                      </div>
                    </div>
                  </div>
                  <div class="col-3">
                    <div class="card card-stacked">
                      <div class="card-body text-center">
                        <h3 class="card-title">배송 대기</h3>
                        <a class="text-muted w-auto btn"
                           href="javascript:openWindowPop('/mypage/order-popup?code=3', 'popup');">___건</a>
                      </div>
                    </div>
                  </div>
                  <div class="col-3">
                    <div class="card card-stacked">
                      <div class="card-body text-center">
                        <h3 class="card-title">배송중</h3>
                        <a class="text-muted w-auto btn"
                           href="javascript:openWindowPop('/mypage/order-popup?code=4', 'popup');">___건</a>
                      </div>
                    </div>
                  </div>
                  <div class="col-3">
                    <div class="card card-stacked">
                      <div class="card-body text-center">
                        <h3 class="card-title">배송 완료</h3>
                        <a class="text-muted w-auto btn"
                           href="javascript:openWindowPop('/mypage/order-popup?code=5', 'popup');">___건</a>
                      </div>
                    </div>
                  </div>
                  <hr>
                  <div class="w-full">
                    <h3 class="sub-title d-inline">위시 리스트</h3>
                    <a href="#" class="btn btn-primary w-auto float-end btn-sm d-inline">더 보기</a>
                  </div>
                  <div class="border-1 border-muted w-auto">
                    <div class="row row-cards w-full">
                      <div class="col-3" th:each="a : ${#numbers.sequence(0,3)}">
                        <div class="card">
                          <div class="card-body"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <hr>
                  <div class="w-full">
                    <h3 class="sub-title d-inline">최근 본 상품</h3>
                    <a href="#" class="btn btn-primary w-auto float-end btn-sm d-inline">더 보기</a>
                  </div>
                  <div class="border-1 border-muted w-auto">
                    <div class="row row-cards w-full">
                      <div class="col-3" th:each="a : ${#numbers.sequence(0,3)}">
                        <div class="card">
                          <div class="card-body"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- modal  -->
    <div class="modal modal-blur fade" id="modal-full-width" tabindex="-1" style="display: none;"
         aria-hidden="true">
      <div class="modal-dialog modal-full-width modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Full width modal</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"
                    aria-label="Close"></button>
          </div>
          <div class="card">
            <div class="card-body">
              <table class="table text-center">
                <thead>
                <tr>
                  <th class="fs-4" scope="col">주문번호</th>
                  <th class="fs-4" scope="col">주문일자</th>
                  <th class="fs-4" scope="col">주문내역</th>
                  <th class="fs-4" scope="col">주문금액</th>
                  <th class="fs-4" scope="col">수령인</th>
                  <th class="fs-4" scope="col">비고</th>
                  <th class="fs-4" scope="col" th:width="100px">조회/삭제</th>
                </tr>
                </thead>
                <tbody class="table-group-divider">

                <!--              <tr th:each="data: ${dataList}">-->
                <!--                <td th:text="${data.orderName}"></td>-->
                <!--                <td th:text="${#temporals.format(data.orderDateTime, 'yyyy-MM-dd')}"></td>-->
                <!--                <td class="text-start">-->
                <!--                  <div class="row-cols-2">-->
                <!--                    <p class="col-12 d-inline-block text-truncate"-->
                <!--                       th:text="${data.orderName}"-->
                <!--                       style="max-width: 140px;">-->
                <!--                    </p>-->
                <!--                    <p class="col-12 d-inline-block text-truncate"-->
                <!--                       style="max-width: 140px;">-->
                <!--                      <span>총</span>&nbsp;-->
                <!--                      <span th:text="${data.orderProductCount == null } ? 0 : ${data.orderProductCount}">228</span>-->
                <!--                      <span>종</span>&nbsp;-->
                <!--                      <span th:text="${data.productTotalCount == null } ? 0 : ${data.productTotalCount}">2445</span>-->
                <!--                      <span>권</span>-->
                <!--                    </p>-->
                <!--                  </div>-->
                <!--                </td>-->
                <!--                <td>-->
                <!--                                                    <span class="d-inline-block text-truncate"-->
                <!--                                                          style="max-width: 100px;" th:text="${data.orderAmount}">-->
                <!--                                                        222,500-->
                <!--                                                    </span>-->
                <!--                </td>-->
                <!--                <td class="text-orange" th:text="${data.orderStatusCode}"></td>-->
                <!--                <td class="fw-bolder" th:text="${data.memberName}"></td>-->
                <!--                <td class="" th:text="${data.orderCode == 'MEMBER_SUBSCRIBE'} ? '구독 주문':''"></td>-->
                <!--                <td>-->
                <!--                                <div>-->
                <!--                                  <a href="#" th:value="${data.orderId}" class="btn btn-outline-dark w-full fs-5 fw-bolder m-1">-->
                <!--                                    주문상세조회-->
                <!--                                  </a>-->
                <!--                                  <a href="#" th:value="${data.orderId}" class="btn btn-outline-dark w-full fs-5 fw-bolder m-1">-->
                <!--                                    배송조회-->
                <!--                                  </a>-->
                <!--                                  &lt;!&ndash;                                               // TODO 숨김처리 링크 처리         &ndash;&gt;-->
                <!--                                  <a href="#" th:value="${data.orderId}" class="btn btn-outline-secondary w-full fs-5 m-1">-->
                <!--                                    숨김처리-->
                <!--                                  </a>-->
                <!--                                </div>-->
                <!--                </td>-->
                <!--              </tr>-->
                </tbody>
              </table>
            </div>
            <!--          <div-->
            <!--              th:replace="~{common/utils/paging :: paging('/mypage/orders', ${code == null ? '' : '&code=' + code})}">-->
            <!--          </div>-->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn me-auto" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Save changes
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- TODO 4 : footer -->
    <div th:replace="~{common/fragments/footer :: fragment-footer}"></div>
  </div>
</div>

<script>
  const mypage = document.getElementById("mypage");
  const mainUrl = `${mypage.getAttribute("data-url")}`;
  const innerMemberGradeUrl = `${mypage.getAttribute("data-url")}/grade`;
  const innerMemberPointUrl = `${mypage.getAttribute("data-url")}/point`;
  const shopUrl = `${mypage.getAttribute("data-shop-url")}`;

  function openWindowPop(url, name) {
    let options = 'top=10, left=10, width=900, height=500, status=no, menubar=no, location=no, toolbar=no, resizable=no';
    let pop = window.open(url, name, options);

  }

  window.onload = function () {
    setMyPageData();
  }

  async function setMyPageData() {
    const grade = document.getElementById("member-grade");
    const point = document.getElementById("member-point");

    try {
      grade.value = getMemberGrade();
      point.value = getMemberPoint();
    } catch (err) {
      console.log(err)
      if (!alert("회원 정보를 찾을 수 없습니다.")) {
        document.location = mainUrl;
      }
    }
  }

  function getMemberGrade() {
    const response = fetch(innerMemberGradeUrl, {
      method: "GET",
      headers: {
        "Contest-Type": "application/json"
      }
    });
    return response;
  }

  function getMemberPoint() {
    const response = fetch(innerMemberPointUrl, {
      method: "GET",
      headers: {
        "Contest-Type": "application/json"
      }
    });
    return response;
  }
</script>
</body>
</html>
